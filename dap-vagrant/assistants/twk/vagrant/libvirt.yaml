fullname: libvirt provider (recommended)
description: Create a Vagrantfile with libvirt as a default provider

dependencies:
- use: super.dependencies
- rpm: ['vagrant-libvirt']

dependencies_domain:
- rpm: ['vagrant-libvirt-doc']

args:
  name:
    use: common_args

  with_polkit_rules:
    flags:
    - -p
    - --include-polkit-rules
    help: 'This includes polkit policies to start libvirt domains without requiring password'
    action: 'store_true'

files:
  libvirtsources: &libvirtsources
    source: .
run:
- setup_project_dir:
    from: $name
    on_existing: fail
    create_topdir: normalized
    topdir_normalized_var: basename
- log_i: 'Creating Vagrantfile with libvirt as a default provider in $basename...'
- cl: cd "$contdir"
- cl_i: cp -r *libvirtsources "$basename"
- cl: cd "$basename"
- if defined $include_polkit_rules:
  - $vagrant_version~: $(rpm -q vagrant-libvirt --qf '%{version}')
  - log_i: "Copy 10-vagrant-libvirt-rules file so that libvirt domain is automatically started"
  - cl: pkexec cp /usr/share/vagrant/gems/doc/vagrant-libvirt-$vagrant_version/polkit/10-vagrant-libvirt.rules /usr/share/polkit-1/rules.d/
